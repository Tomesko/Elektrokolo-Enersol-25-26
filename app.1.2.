import streamlit as st
import pandas as pd

# --- KONSTANTY ---
# Pro sol√°rn√≠ v√Ωpoƒçet st√°le pot≈ôebujeme √∫ƒçinnost panelu
EFF_PANEL = 0.70

st.set_page_config(page_title="Solar Bike Thesis", layout="wide")

# --- DATA LOKALIT (Pro sol√°rn√≠ zisk) ---
LOKALITA_DATA = {
    "Hostou≈à (Rovina)":      {"osvit": 3.8},
    "Praha (M√≠rn√© kopce)":   {"osvit": 3.5},
    "Brno (Zvlnƒõn√©)":        {"osvit": 3.6},
    "≈†umava (Hory)":         {"osvit": 3.0},
    "It√°lie (Jih)":          {"osvit": 5.0},
    "Vlastn√≠ nastaven√≠":     {"osvit": 0.0}
}

# --- SIDEBAR: VSTUPN√ç PARAMETRY ---
st.sidebar.header("‚öôÔ∏è 1) Parametry j√≠zdy")
# Tv≈Øj k√≥d vy≈æaduje hmotnost na vstupu, tak ji zde nech√°v√°m
celkova_hmotnost = st.sidebar.number_input("Celkov√° hmotnost (kg)", value=100)
prumerna_rychlost = st.sidebar.number_input("Pr≈Ømƒõrn√° rychlost (km/h)", value=25)

st.sidebar.header("üîã 2) Baterie a Motor")
kapacita_baterie = st.sidebar.number_input("Kapacita baterie [Wh]", value=540)
vykon_motoru = st.sidebar.number_input("V√Ωkon motoru [W]", value=250)

# V√Ωbƒõr √∫rovnƒõ asistence (1-5) a p≈ôevod na procenta pro tv≈Øj vzorec
st.sidebar.write("√örove≈à asistence")
level = st.sidebar.select_slider("Vyberte stupe≈à", options=[1, 2, 3, 4, 5], value=3)

# P≈ôevod na desetinn√© ƒç√≠slo (nap≈ô. Level 5 = 1.0 = 100%)
# Pokud chce≈°, aby Level 1 byl t≈ôeba 0.2 (20%), nech√°me to takto:
procento_asistence = level * 0.2 
st.sidebar.caption(f"Procento asistence ve vzorci: {procento_asistence:.1f} ({procento_asistence*100:.0f}%)")

st.sidebar.header("‚òÄÔ∏è 3) Sol√°r a Lokalita")
vykon_panelu_wp = st.sidebar.number_input("Nomin√°ln√≠ v√Ωkon solar. panelu [Wp]", value=100)

# V√ùBƒöR LOKALITY
lokalita = st.sidebar.selectbox("Vyberte lokalitu", list(LOKALITA_DATA.keys()))

# V√Ωpoƒçet sol√°rn√≠ energie
if lokalita == "Vlastn√≠ nastaven√≠":
    dodana_energie_wh = st.sidebar.number_input("Dodan√° energie z osvitu [Wh]", value=150)
else:
    data = LOKALITA_DATA[lokalita]
    osvit_regionu = data["osvit"]
    dodana_energie_wh = vykon_panelu_wp * osvit_regionu * EFF_PANEL
    st.sidebar.success(f"‚òÄÔ∏è Sol√°rn√≠ zisk: **{dodana_energie_wh:.0f} Wh**")

# ==============================================================================
# --- V√ùPOƒåET DLE TV√âHO K√ìDU ---
# ==============================================================================

# Tv≈Øj vzorec: celkovy_vykon_motoru = vykon_motoru * procento_asistence
celkovy_vykon_motoru = vykon_motoru * procento_asistence

# Prevence dƒõlen√≠ nulou
if celkovy_vykon_motoru > 0:
    # Tv≈Øj vzorec: dojezd = (kapacita_baterie / celkovy_vykon_motoru) * prumerna_rychlost
    
    # 1. Dojezd jen na baterii
    dojezd_bat = (kapacita_baterie / celkovy_vykon_motoru) * prumerna_rychlost
    
    # 2. Dojezd se sol√°rem (p≈ôiƒçteme energii ze slunce k baterii)
    # Logika: (Baterie + Sol√°r) / V√Ωkon * Rychlost
    dojezd_solar = ((kapacita_baterie + dodana_energie_wh) / celkovy_vykon_motoru) * prumerna_rychlost
else:
    dojezd_bat = 0
    dojezd_solar = 0

bonus_km = dojezd_solar - dojezd_bat

# ==============================================================================
# --- DASHBOARD ---
# ==============================================================================

st.title("üîã Solar Bike Thesis: Kalkul√°tor")
st.markdown("**Metoda v√Ωpoƒçtu:** Konstantn√≠ odbƒõr (Zjednodu≈°en√Ω model)")

# Metriky
m1, m2, m3 = st.columns(3)
m1.metric("Odeb√≠ran√Ω v√Ωkon", f"{celkovy_vykon_motoru:.0f} W")
m2.metric("Dojezd (Jen Baterie)", f"{dojezd_bat:.1f} km")
m3.metric("Dojezd (+ Sol√°r)", f"{dojezd_solar:.1f} km", delta=f"+{bonus_km:.1f} km")

st.divider()

col_graph, col_data = st.columns([2, 1])

with col_graph:
    st.subheader("Porovn√°n√≠ dojezdu")
    chart_data = pd.DataFrame({
        'Zdroj': ['Jen Baterie', 'Baterie + Sol√°r'],
        'Dojezd (km)': [dojezd_bat, dojezd_solar]
    })
    st.bar_chart(chart_data.set_index('Zdroj'))

with col_data:
    st.subheader("Vstupn√≠ data")
    st.write(f"Hmotnost: **{celkova_hmotnost} kg**")
    st.write(f"Rychlost: **{prumerna_rychlost} km/h**")
    st.write(f"Kapacita aku: **{kapacita_baterie} Wh**")
    st.write(f"V√Ωkon motoru: **{vykon_motoru} W**")
    st.write(f"Asistence: **{procento_asistence*100:.0f} %**")
    st.success(f"Sol√°rn√≠ energie: **{dodana_energie_wh:.0f} Wh**")
